# Filesystem Audit

:warning:
**The process described here involves running malware.
Do not follow these steps unless you know exactly what you are doing.
Use extreme caution and do not run malware outside of a sandbox environment.**
:warning:

## Setup audit

Audit rules must be set up prior to running any malware to record its activities.

### Audit rules

Open `Properties` for the filesystem to be audited (e.g. the C: drive).
Go to `Security > Advanced > Auditing > Add`

- For `Principal` write `Everyone`.
- For `Type` select `All`.
- For `Applies to` select `This folder, subfolders, and files`.
- For `Basic permissions:` select `Modify`, `Read & execute`, `List folder contents`, `Read`, and `Write`.

Apply the settings and select `Continue` for any errors.

### Event log filters

Go to Event Viewer, right-click `Custom Views` and select `Create Custom View...`.

- For `Logged` select a range appropriate for your situation.
- For `Event level` select `Informational`.
- Select `By log` and for `Event logs` select `Windows Logs > Security`.
- For `Includes/Excludes Event IDs:` write `4660, 4663`.

Apply the settings.

## Parsing audit data

### Using the provided script

For convenience, the `parse-filesystem-audit.py` script has been included for filtering audit data.

Uncomment one of the following presets:

```py
#list_all()
#list_OwOGame_Accesses()
#list_OwOGame_Reads()
#list_OwOGame_Writes()
```

or write your own script for parsing the audit data:

```py
# List all items
def list_all():
    for item in items:
        for key in item:
            print(key, ':', item[key])
        print()
```

## Summary
